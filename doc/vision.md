# Техническое видение проекта ИИ-ассистента

## Содержание

1. Технологии
2. Принцип разработки
3. Структура проекта
4. Архитектура проекта
5. Модель данных
6. Работа с LLM
7. Мониторинг LLM
8. Сценарии работы
9. Деплой
10. Подход к конфигурированию
11. Подход к логгированию

---

## Описание
Техническое видение для разработки ИИ-ассистента в виде Telegram-бота для первичной консультации клиентов по принципу KISS (Keep It Simple, Stupid).

---

## 1. Технологии

### Основные технологии
- **Python 3.11+** - основной язык разработки
- **aiogram** - современная асинхронная библиотека для работы с Telegram Bot API
- **OpenAI Client** - для работы с LLM через провайдера OpenRouter
- **OpenRouter** - провайдер доступа к различным LLM моделям через единый API

### Управление проектом и зависимостями
- **uv** - современный менеджер пакетов и виртуальных окружений Python
- **pytest** - фреймворк для тестирования
- **make** - автоматизация сборки, запуска и деплоя

### Инфраструктура
- **Docker** - контейнеризация для деплоя
- **Простые структуры Python (dict/list)** - хранение истории диалогов в памяти
- **Переменные окружения** - конфигурация приложения

## 2. Принцип разработки

### Методология разработки
- **Итеративный подход** - начинаем с MVP и постепенно добавляем функциональность
- **Быстрые итерации** - возможность быстро вносить изменения и тестировать
- **Минимализм** - только необходимый функционал

### Архитектурные принципы
- **Модульность** - разделение кода на логические компоненты
- **Проектирование без ООП** - архитектура через функции и композицию вместо классов
- **Принцип KISS** - Keep It Simple, Stupid, простота важнее излишней сложности

### Качество кода
- **Чистый код** - понятные имена, комментарии, документация
- **Функциональная композиция** - использование чистых функций где возможно
- **Явные зависимости** - передача параметров вместо глобального состояния

### Процесс разработки
- **MVP-first** - сначала минимальная рабочая версия
- **Инкрементальные улучшения** - каждая итерация добавляет одну функцию
- **Быстрая обратная связь** - тестирование на реальных пользователях как можно раньше

## 3. Структура проекта

### Минималистичная структура
```
/
├── main.py              # Точка входа в приложение
├── config.py            # Конфигурация приложения
├── bot/                 # Модули для работы с Telegram API
│   ├── __init__.py
│   └── handlers.py      # Обработчики сообщений
├── llm/                 # Модули для работы с LLM
│   ├── __init__.py
│   └── client.py        # Клиент для работы с OpenRouter/OpenAI
├── tests/               # Тесты
│   └── test_bot.py      # Тесты для бота
├── doc/                 # Документация
│   ├── product_idea.md
│   └── vision.md
├── pyproject.toml       # Конфигурация проекта и зависимостей для uv
├── Dockerfile           # Файл для сборки Docker-контейнера
├── Makefile            # Файл для автоматизации задач
└── .env                 # Файл с переменными окружения и конфигурацией
```


### Архитектурные принципы
1. **Компонентный подход** - четкое разделение ответственности между модулями
2. **Функциональное программирование** - использование функций вместо классов  
3. **Простая схема взаимодействия**: Telegram -> Бот -> LLM -> Бот -> Telegram

### Компоненты системы
```
┌─────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Telegram  │◄── │   Бот (aiogram) │◄── │   LLM Client    │
│  (Клиент)   │    │ (обработчики)   │    │  (OpenRouter)   │
└─────────────┘    └─────────────────┘    └─────────────────┘
       │                     │                       │
   Сообщение -----------> Запрос --------------> Ответ
       │                     │                       │
     Ответ   <-----------    |    <------------   Ответ
```

## 5. Модель данных

### Принципы хранения данных
1. **Хранение истории диалогов в оперативной памяти с использованием структур данных Python (dict/list)**
2. **Простая структура для хранения сообщений пользователя и ответов бота**

### Структуры данных

**Структура сообщения:**
```python
{
    "role": "system" | "user" | "assistant",  # Роль отправителя сообщения
    "content": "текст сообщения"             # Содержимое сообщения
}
```

**Структура диалога:**
```python
{
    "chat_id": 123456789,    # ID чата в Telegram
    "messages": [            # История сообщений
        {"role": "system", "content": "Вы ассистент компании X, которая предоставляет услуги Y..."},
        {"role": "user", "content": "Привет"},
        {"role": "assistant", "content": "Здравствуйте! Чем могу помочь?"}
    ]
}
```

## 6. Работа с LLM

### Подход к взаимодействию с языковой моделью

1. **API-ключ**: Используем OpenRouter API через реализацию OpenAI client
2. **Системный промпт**: включаем информацию о компании и услугах в системный промпт
3. **Контекст**: Отправляем историю диалога для сохранения контекста общения
4. **Обработка ответов**: Простая обработка ответов от LLM без дополнительной постобработки

### Пример функции для работы с LLM

```python
# Пример функции для работы с LLM
async def get_llm_response(dialog_history):
    response = await openai_client.chat.completions.create(
        model="openrouter/model_name",  # Конкретная модель через OpenRouter
        messages=dialog_history,
        temperature=0.7,
        max_tokens=500
    )
    return response.choices[0].message.content
```

## 7. Мониторинг LLM

Минималистичный подход к мониторингу

**Логирование запросов и ответов LLM** - сохраняем историю взаимодействия с LLM для анализа и отладки

## 8. Сценарии работы

### Основные сценарии работы бота

1. **Приветствие и знакомство с клиентом** - установление контакта с пользователем
2. **Консультирование по услугам компании** - ответы на вопросы о компании, услугах, предложение релевантных решений для проблем клиента

## 9. Деплой

### Простой и надежный подход к развертыванию бота

1. **Контейнеризация** - упаковка приложения в Docker-контейнер
2. **Локальный запуск** - запуск Docker-контейнера на локальной машине  
3. **Простой процесс развертывания** - минимум шагов для запуска

## 10. Подход к конфигурированию

### Простой и безопасный подход к конфигурации приложения

**Файл .env** - хранение всех конфигурационных параметров и переменных окружения:
   - API ключи и токены
   - Параметры LLM
   - Системный промпт
   - Другие настройки бота

## 11. Подход к логгированию

### Стандартный и проверенный подход к логированию

1. **Стандартный модуль logging** - использование встроенного в Python модуля для логирования
2. **Логирование основных событий**:
   - Запуск и остановка бота
   - Ошибки и исключения
   - Запросы и ответы LLM
3. **Уровни логирования**:
   - INFO - стандартные информационные сообщения
   - ERROR - ошибки и исключения
   - DEBUG - подробная отладочная информация